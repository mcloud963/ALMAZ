<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALMAZ - Игровая платформа</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: rgba(10, 10, 40, 0.95);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid #ffcc00;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            color: #ffcc00;
            font-size: 2.2rem;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            background: linear-gradient(to right, #ffcc00, #ff6b00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }
        
        nav a {
            color: #fff;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s;
            padding: 8px 12px;
            border-radius: 5px;
        }
        
        nav a:hover {
            color: #ffcc00;
            background: rgba(255, 204, 0, 0.1);
        }
        
        .user-panel {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 204, 0, 0.1);
            padding: 8px 15px;
            border-radius: 50px;
        }
        
        .user-name {
            color: #ffcc00;
            font-weight: 600;
        }
        
        .user-balance {
            background: rgba(0, 204, 255, 0.1);
            padding: 8px 15px;
            border-radius: 50px;
            color: #00ccff;
            font-weight: 600;
        }
        
        .btn {
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-size: 1rem;
        }
        
        .btn-login {
            background: transparent;
            color: #fff;
            border: 2px solid #00ccff;
        }
        
        .btn-login:hover {
            background: rgba(0, 204, 255, 0.1);
        }
        
        .btn-register {
            background: linear-gradient(to right, #ffcc00, #ff6b00);
            color: #0a0a1a;
        }
        
        .btn-register:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.4);
        }
        
        .logout-btn {
            background: rgba(255, 51, 51, 0.1);
            color: #ff3333;
            border: 1px solid rgba(255, 51, 51, 0.3);
            padding: 8px 15px;
            border-radius: 50px;
            cursor: pointer;
        }
        
        .logout-btn:hover {
            background: rgba(255, 51, 51, 0.2);
        }
        
        .hero {
            padding: 80px 0;
            text-align: center;
        }
        
        .hero h2 {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #ffcc00;
        }
        
        .games-section {
            padding: 60px 0;
        }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }
        
        .game-card {
            background: rgba(20, 20, 60, 0.7);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s;
        }
        
        .game-card:hover {
            transform: translateY(-10px);
        }
        
        .game-icon {
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: white;
        }
        
        .mine-bg {
            background: linear-gradient(to bottom, #ff3333, #990000);
        }
        
        .rocket-bg {
            background: linear-gradient(to bottom, #3366ff, #003399);
        }
        
        .dice-bg {
            background: linear-gradient(to bottom, #33cc33, #006600);
        }
        
        .coin-bg {
            background: linear-gradient(to bottom, #ffcc00, #cc9900);
        }
        
        .game-info {
            padding: 20px;
        }
        
        .game-info h3 {
            color: #ffcc00;
            margin-bottom: 10px;
        }
        
        .play-btn {
            display: inline-block;
            background: linear-gradient(to right, #3366ff, #00ccff);
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 10px;
            border: none;
            cursor: pointer;
            width: 100%;
        }
        
        .play-btn:hover {
            opacity: 0.9;
        }
        
        .play-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        /* Модальные окна */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #0a0a1a);
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            border: 2px solid rgba(255, 204, 0, 0.3);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ffcc00;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 204, 0, 0.3);
            border-radius: 8px;
            color: white;
        }
        
        .game-modal {
            max-width: 800px;
        }
        
        .game-container {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        
        .mine-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .mine-cell {
            width: 60px;
            height: 60px;
            background: #3366ff;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mine-cell:hover {
            background: #4488ff;
            transform: scale(1.05);
        }
        
        .mine-cell.revealed {
            background: #33cc33;
        }
        
        .mine-cell.mine {
            background: #ff3333;
        }
        
        .rocket-container {
            height: 300px;
            position: relative;
            margin: 20px 0;
        }
        
        .rocket {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            font-size: 4rem;
            color: #ffcc00;
            transition: bottom 3s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }
        
        .rocket.flying {
            bottom: 80%;
        }
        
        .rocket-controls {
            margin-top: 20px;
        }
        
        .multiplier {
            font-size: 2rem;
            color: #ffcc00;
            text-align: center;
            margin: 20px 0;
        }
        
        .dice-result {
            font-size: 5rem;
            text-align: center;
            margin: 20px 0;
            color: #ffcc00;
        }
        
        .dice-roll {
            animation: roll 0.5s ease-in-out;
        }
        
        @keyframes roll {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .coin-result {
            font-size: 5rem;
            text-align: center;
            margin: 20px 0;
            color: #ffcc00;
        }
        
        .coin-flip {
            animation: flip 0.5s ease-in-out;
        }
        
        @keyframes flip {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        
        .game-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 204, 0, 0.1);
            border-radius: 10px;
        }
        
        .bet-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 20px 0;
        }
        
        .bet-amount {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 1.2rem;
        }
        
        footer {
            background: rgba(10, 10, 40, 0.9);
            padding: 30px 0;
            margin-top: 60px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            .mine-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .mine-cell {
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-gem"></i>
                    <h1>ALMAZ</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="#"><i class="fas fa-home"></i> Главная</a></li>
                        <li><a href="#games"><i class="fas fa-gamepad"></i> Игры</a></li>
                        <li><a href="#"><i class="fas fa-trophy"></i> Турниры</a></li>
                    </ul>
                </nav>
                
                <!-- Панель пользователя (меняется в зависимости от авторизации) -->
                <div id="authSection">
                    <div class="user-panel" id="userPanel" style="display: none;">
                        <div class="user-info">
                            <i class="fas fa-user"></i>
                            <span class="user-name" id="displayUsername">Гость</span>
                        </div>
                        <div class="user-balance">
                            Баланс: <span id="displayBalance">1000</span> ₽
                        </div>
                        <button class="logout-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                    
                    <div class="auth-buttons" id="authButtons">
                        <button class="btn btn-login" id="loginBtn"><i class="fas fa-sign-in-alt"></i> Вход</button>
                        <button class="btn btn-register" id="registerBtn"><i class="fas fa-user-plus"></i> Регистрация</button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <section class="hero">
        <div class="container">
            <h2>Игровая платформа ALMAZ</h2>
            <p>Играйте в увлекательные игры и выигрывайте призы! Зарегистрируйтесь, чтобы получить стартовый бонус.</p>
        </div>
    </section>
    
    <section class="games-section" id="games">
        <div class="container">
            <h2 style="text-align: center; color: #ffcc00; margin-bottom: 30px;">Игры</h2>
            <div class="games-grid">
                <!-- Игра Мины -->
                <div class="game-card">
                    <div class="game-icon mine-bg">
                        <i class="fas fa-bomb"></i>
                    </div>
                    <div class="game-info">
                        <h3>Мины</h3>
                        <p>Найдите все алмазы, избегая мин. Каждый шаг увеличивает множитель выигрыша.</p>
                        <button class="play-btn" data-game="mine">Играть в Мины</button>
                    </div>
                </div>
                
                <!-- Игра Ракета -->
                <div class="game-card">
                    <div class="game-icon rocket-bg">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <div class="game-info">
                        <h3>Ракета</h3>
                        <p>Запустите ракету и вовремя остановите её, чтобы получить максимальный выигрыш.</p>
                        <button class="play-btn" data-game="rocket">Играть в Ракету</button>
                    </div>
                </div>
                
                <!-- Игра Кости -->
                <div class="game-card">
                    <div class="game-icon dice-bg">
                        <i class="fas fa-dice"></i>
                    </div>
                    <div class="game-info">
                        <h3>Кости</h3>
                        <p>Бросьте кости и попытайтесь угадать результат. Просто, но увлекательно!</p>
                        <button class="play-btn" data-game="dice">Играть в Кости</button>
                    </div>
                </div>
                
                <!-- Игра Монетка -->
                <div class="game-card">
                    <div class="game-icon coin-bg">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="game-info">
                        <h3>Монетка</h3>
                        <p>Орел или решка? Сделайте ставку и испытайте свою удачу.</p>
                        <button class="play-btn" data-game="coin">Играть в Монетку</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Модальное окно входа -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <h2 style="color: #ffcc00; text-align: center; margin-bottom: 20px;">Вход</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">Имя пользователя</label>
                    <input type="text" id="loginUsername" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Пароль</label>
                    <input type="password" id="loginPassword" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-register" style="width: 100%;">Войти</button>
            </form>
            <div style="text-align: center; margin-top: 15px;">
                <span style="color: #ccc;">Нет аккаунта? </span>
                <a href="#" id="showRegisterForm" style="color: #00ccff;">Зарегистрироваться</a>
            </div>
            <button class="btn btn-login" style="width: 100%; margin-top: 15px;" id="closeLoginModal">Закрыть</button>
        </div>
    </div>
    
    <!-- Модальное окно регистрации -->
    <div class="modal-overlay" id="registerModal">
        <div class="modal-content">
            <h2 style="color: #ffcc00; text-align: center; margin-bottom: 20px;">Регистрация</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="regUsername">Имя пользователя</label>
                    <input type="text" id="regUsername" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="regEmail">Email</label>
                    <input type="email" id="regEmail" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">Пароль</label>
                    <input type="password" id="regPassword" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="regConfirmPassword">Подтвердите пароль</label>
                    <input type="password" id="regConfirmPassword" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-register" style="width: 100%;">Зарегистрироваться</button>
            </form>
            <div style="text-align: center; margin-top: 15px;">
                <span style="color: #ccc;">Уже есть аккаунт? </span>
                <a href="#" id="showLoginForm" style="color: #00ccff;">Войти</a>
            </div>
            <button class="btn btn-login" style="width: 100%; margin-top: 15px;" id="closeRegisterModal">Закрыть</button>
        </div>
    </div>
    
    <!-- Модальное окно игры -->
    <div class="modal-overlay" id="gameModal">
        <div class="modal-content game-modal">
            <h2 id="gameTitle" style="color: #ffcc00; text-align: center;"></h2>
            <div class="game-container" id="gameContainer">
                <!-- Контент игры будет загружаться сюда -->
            </div>
            <button class="btn btn-login" style="width: 100%; margin-top: 20px;" id="closeGameModal">Закрыть игру</button>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>© 2023 ALMAZ Gaming. Демо-версия. Все данные хранятся локально в вашем браузере.</p>
            <p style="margin-top: 10px; color: #ccc; font-size: 0.9rem;">Это демонстрационный проект для обучения. Не используйте реальные данные.</p>
        </div>
    </footer>

    <script>
        // Система пользователей (данные хранятся только в LocalStorage браузера)
        class UserSystem {
            constructor() {
                this.currentUser = null;
                this.users = JSON.parse(localStorage.getItem('almaz_users')) || [];
                this.loadCurrentUser();
            }
            
            // Загрузка текущего пользователя
            loadCurrentUser() {
                const savedUser = localStorage.getItem('almaz_current_user');
                if (savedUser) {
                    this.currentUser = JSON.parse(savedUser);
                    this.updateUI();
                }
            }
            
            // Регистрация нового пользователя
            register(username, email, password) {
                // Проверяем, существует ли пользователь
                if (this.users.find(u => u.username === username)) {
                    return { success: false, message: 'Пользователь с таким именем уже существует' };
                }
                
                if (this.users.find(u => u.email === email)) {
                    return { success: false, message: 'Пользователь с таким email уже существует' };
                }
                
                // Создаем нового пользователя
                const newUser = {
                    id: Date.now(),
                    username,
                    email,
                    password: this.hashPassword(password), // В реальном проекте НЕ ДЕЛАЙТЕ ТАК!
                    balance: 1000, // Стартовый баланс
                    registered: new Date().toISOString()
                };
                
                this.users.push(newUser);
                this.saveUsers();
                
                // Автоматически входим после регистрации
                return this.login(username, password);
            }
            
            // Вход пользователя
            login(username, password) {
                const user = this.users.find(u => 
                    (u.username === username || u.email === username) && 
                    u.password === this.hashPassword(password)
                );
                
                if (user) {
                    this.currentUser = { ...user };
                    localStorage.setItem('almaz_current_user', JSON.stringify(this.currentUser));
                    this.updateUI();
                    return { success: true, user: this.currentUser };
                }
                
                return { success: false, message: 'Неверное имя пользователя или пароль' };
            }
            
            // Выход пользователя
            logout() {
                this.currentUser = null;
                localStorage.removeItem('almaz_current_user');
                this.updateUI();
            }
            
            // Обновление баланса
            updateBalance(amount) {
                if (!this.currentUser) return false;
                
                this.currentUser.balance += amount;
                
                // Обновляем в общем списке
                const userIndex = this.users.findIndex(u => u.id === this.currentUser.id);
                if (userIndex !== -1) {
                    this.users[userIndex].balance = this.currentUser.balance;
                    this.saveUsers();
                }
                
                localStorage.setItem('almaz_current_user', JSON.stringify(this.currentUser));
                this.updateUI();
                return true;
            }
            
            // Простая хэш-функция (для демо!)
            hashPassword(password) {
                // ⚠️ ВНИМАНИЕ: Это НЕ безопасный метод хэширования!
                // В реальном проекте используйте bcrypt или аналоги
                return btoa(password + 'almaz_salt');
            }
            
            // Сохранение пользователей
            saveUsers() {
                localStorage.setItem('almaz_users', JSON.stringify(this.users));
            }
            
            // Обновление интерфейса
            updateUI() {
                const userPanel = document.getElementById('userPanel');
                const authButtons = document.getElementById('authButtons');
                
                if (this.currentUser) {
                    // Показываем панель пользователя
                    userPanel.style.display = 'flex';
                    authButtons.style.display = 'none';
                    
                    // Обновляем данные
                    document.getElementById('displayUsername').textContent = this.currentUser.username;
                    document.getElementById('displayBalance').textContent = this.currentUser.balance;
                    
                    // Разблокируем кнопки игр
                    document.querySelectorAll('.play-btn').forEach(btn => {
                        btn.disabled = false;
                    });
                } else {
                    // Показываем кнопки входа/регистрации
                    userPanel.style.display = 'none';
                    authButtons.style.display = 'flex';
                    
                    // Блокируем кнопки игр
                    document.querySelectorAll('.play-btn').forEach(btn => {
                        btn.disabled = true;
                    });
                }
            }
        }
        
        // Инициализация системы пользователей
        const userSystem = new UserSystem();
        
        // Игровая система
        class GameSystem {
            constructor() {
                this.currentGame = null;
                this.currentBet = 10;
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                // Кнопки игр
                document.querySelectorAll('.play-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (!userSystem.currentUser) {
                            alert('Для игры необходимо войти в систему!');
                            document.getElementById('loginModal').style.display = 'flex';
                            return;
                        }
                        
                        const gameType = e.target.dataset.game;
                        this.startGame(gameType);
                    });
                });
                
                // Управление ставками
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('bet-minus')) {
                        this.changeBet(-10);
                    } else if (e.target.classList.contains('bet-plus')) {
                        this.changeBet(10);
                    }
                });
            }
            
            changeBet(amount) {
                this.currentBet = Math.max(10, this.currentBet + amount);
                document.getElementById('currentBet').textContent = this.currentBet;
            }
            
            startGame(gameType) {
                this.currentGame = gameType;
                const gameTitle = document.getElementById('gameTitle');
                const gameContainer = document.getElementById('gameContainer');
                
                // Устанавливаем заголовок
                const gameNames = {
                    'mine': 'Игра "Мины"',
                    'rocket': 'Игра "Ракета"',
                    'dice': 'Игра "Кости"',
                    'coin': 'Игра "Монетка"'
                };
                gameTitle.textContent = gameNames[gameType];
                
                // Загружаем игру
                switch(gameType) {
                    case 'mine':
                        this.loadMineGame(gameContainer);
                        break;
                    case 'rocket':
                        this.loadRocketGame(gameContainer);
                        break;
                    case 'dice':
                        this.loadDiceGame(gameContainer);
                        break;
                    case 'coin':
                        this.loadCoinGame(gameContainer);
                        break;
                }
                
                // Показываем модальное окно
                document.getElementById('gameModal').style.display = 'flex';
            }
            
            loadMineGame(container) {
                container.innerHTML = `
                    <div class="game-stats">
                        <div>Баланс: <span style="color: #ffcc00;">${userSystem.currentUser.balance}</span> ₽</div>
                        <div>Ставка: <span style="color: #00ccff;" id="currentBet">${this.currentBet}</span> ₽</div>
                        <div>Множитель: <span style="color: #33cc33;" id="mineMultiplier">1x</span></div>
                    </div>
                    
                    <div class="bet-controls">
                        <button class="btn bet-minus">-10</button>
                        <span class="bet-amount">Ставка: ${this.currentBet} ₽</span>
                        <button class="btn bet-plus">+10</button>
                    </div>
                    
                    <div class="mine-grid" id="mineGrid">
                        ${Array(25).fill().map((_, i) => 
                            `<div class="mine-cell" data-cell="${i}">?</div>`
                        ).join('')}
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-register" id="cashOut">Забрать выигрыш</button>
                        <button class="btn btn-login" id="resetMine">Новая игра</button>
                    </div>
                    
                    <div id="mineResult" style="text-align: center; margin-top: 20px;"></div>
                `;
                
                this.setupMineGame();
            }
            
            setupMineGame() {
                const cells = document.querySelectorAll('.mine-cell');
                const minePositions = new Set();
                
                // Случайно размещаем 5 мин
                while (minePositions.size < 5) {
                    minePositions.add(Math.floor(Math.random() * 25));
                }
                
                let multiplier = 1;
                let gameActive = true;
                
                cells.forEach(cell => {
                    cell.addEventListener('click', () => {
                        if (!gameActive) return;
                        
                        const cellIndex = parseInt(cell.dataset.cell);
                        
                        if (minePositions.has(cellIndex)) {
                            // Попали на мину
                            cell.innerHTML = '<i class="fas fa-bomb"></i>';
                            cell.classList.add('mine');
                            gameActive = false;
                            
                            userSystem.updateBalance(-this.currentBet);
                            document.getElementById('mineResult').innerHTML = 
                                `<div style="color: #ff3333; font-size: 1.2rem;">
                                    <i class="fas fa-times"></i> Вы проиграли ${this.currentBet} ₽
                                </div>`;
                        } else {
                            // Нашли алмаз
                            cell.innerHTML = '<i class="fas fa-gem"></i>';
                            cell.classList.add('revealed');
                            multiplier *= 1.5;
                            
                            document.getElementById('mineMultiplier').textContent = multiplier.toFixed(1) + 'x';
                        }
                    });
                });
                
                document.getElementById('cashOut').addEventListener('click', () => {
                    if (gameActive && multiplier > 1) {
                        const winAmount = Math.floor(this.currentBet * multiplier);
                        userSystem.updateBalance(winAmount);
                        gameActive = false;
                        
                        document.getElementById('mineResult').innerHTML = 
                            `<div style="color: #33cc33; font-size: 1.2rem;">
                                <i class="fas fa-check"></i> Вы выиграли ${winAmount} ₽!
                            </div>`;
                    }
                });
                
                document.getElementById('resetMine').addEventListener('click', () => {
                    this.loadMineGame(document.getElementById('gameContainer'));
                });
            }
            
            loadRocketGame(container) {
                container.innerHTML = `
                    <div class="game-stats">
                        <div>Баланс: <span style="color: #ffcc00;">${userSystem.currentUser.balance}</span> ₽</div>
                        <div>Ставка: <span style="color: #00ccff;" id="currentBet">${this.currentBet}</span> ₽</div>
                    </div>
                    
                    <div class="bet-controls">
                        <button class="btn bet-minus">-10</button>
                        <span class="bet-amount">Ставка: ${this.currentBet} ₽</span>
                        <button class="btn bet-plus">+10</button>
                    </div>
                    
                    <div class="rocket-container">
                        <div class="rocket" id="rocket">
                            <i class="fas fa-rocket"></i>
                        </div>
                    </div>
                    
                    <div class="multiplier" id="rocketMultiplier">1.0x</div>
                    
                    <div class="rocket-controls" style="text-align: center;">
                        <button class="btn btn-register" id="launchRocket">Запустить ракету</button>
                        <button class="btn btn-login" id="stopRocket">Остановить</button>
                    </div>
                    
                    <div id="rocketResult" style="text-align: center; margin-top: 20px;"></div>
                `;
                
                this.setupRocketGame();
            }
            
            setupRocketGame() {
                const rocket = document.getElementById('rocket');
                const launchBtn = document.getElementById('launchRocket');
                const stopBtn = document.getElementById('stopRocket');
                const multiplierDisplay = document.getElementById('rocketMultiplier');
                
                let rocketFlying = false;
                let multiplier = 1;
                let flightInterval;
                
                launchBtn.addEventListener('click', () => {
                    if (rocketFlying) return;
                    
                    rocketFlying = true;
                    rocket.classList.add('flying');
                    multiplier = 1;
                    
                    flightInterval = setInterval(() => {
                        multiplier += 0.1;
                        multiplierDisplay.textContent = multiplier.toFixed(1) + 'x';
                        
                        // Случайный краш
                        if (Math.random() < 0.02) {
                            this.crashRocket(multiplier);
                        }
                    }, 200);
                });
                
                stopBtn.addEventListener('click', () => {
                    if (!rocketFlying) return;
                    
                    this.stopRocket(multiplier);
                });
            }
            
            crashRocket(multiplier) {
                clearInterval(flightInterval);
                document.getElementById('rocket').classList.remove('flying');
                
                userSystem.updateBalance(-this.currentBet);
                document.getElementById('rocketResult').innerHTML = 
                    `<div style="color: #ff3333; font-size: 1.2rem;">
                        <i class="fas fa-times"></i> Ракета упала! Вы проиграли ${this.currentBet} ₽
                    </div>`;
            }
            
            stopRocket(multiplier) {
                clearInterval(flightInterval);
                document.getElementById('rocket').classList.remove('flying');
                rocketFlying = false;
                
                const winAmount = Math.floor(this.currentBet * multiplier);
                userSystem.updateBalance(winAmount);
                
                document.getElementById('rocketResult').innerHTML = 
                    `<div style="color: #33cc33; font-size: 1.2rem;">
                        <i class="fas fa-check"></i> Вы выиграли ${winAmount} ₽!
                    </div>`;
            }
            
            loadDiceGame(container) {
                container.innerHTML = `
                    <div class="game-stats">
                        <div>Баланс: <span style="color: #ffcc00;">${userSystem.currentUser.balance}</span> ₽</div>
                        <div>Ставка: <span style="color: #00ccff;" id="currentBet">${this.currentBet}</span> ₽</div>
                    </div>
                    
                    <div class="bet-controls">
                        <button class="btn bet-minus">-10</button>
                        <span class="bet-amount">Ставка: ${this.currentBet} ₽</span>
                        <button class="btn bet-plus">+10</button>
                    </div>
                    
                    <div class="dice-result" id="diceResult">
                        <i class="fas fa-dice"></i>
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="btn btn-register" id="rollDice">Бросить кости</button>
                    </div>
                    
                    <div id="diceGameResult" style="text-align: center; margin-top: 20px;"></div>
                `;
                
                document.getElementById('rollDice').addEventListener('click', () => {
                    const dice = document.getElementById('diceResult');
                    dice.classList.add('dice-roll');
                    
                    setTimeout(() => {
                        dice.classList.remove('dice-roll');
                        const roll1 = Math.floor(Math.random() * 6) + 1;
                        const roll2 = Math.floor(Math.random() * 6) + 1;
                        const total = roll1 + roll2;
                        
                        dice.innerHTML = `${roll1} + ${roll2} = <span style="color: #ffcc00;">${total}</span>`;
                        
                        // Простая логика выигрыша
                        if (total >= 7) {
                            const winAmount = this.currentBet * 2;
                            userSystem.updateBalance(winAmount);
                            document.getElementById('diceGameResult').innerHTML = 
                                `<div style="color: #33cc33; font-size: 1.2rem;">
                                    <i class="fas fa-check"></i> Вы выиграли ${winAmount} ₽!
                                </div>`;
                        } else {
                            userSystem.updateBalance(-this.currentBet);
                            document.getElementById('diceGameResult').innerHTML = 
                                `<div style="color: #ff3333; font-size: 1.2rem;">
                                    <i class="fas fa-times"></i> Вы проиграли ${this.currentBet} ₽
                                </div>`;
                        }
                    }, 500);
                });
            }
            
            loadCoinGame(container) {
                container.innerHTML = `
                    <div class="game-stats">
                        <div>Баланс: <span style="color: #ffcc00;">${userSystem.currentUser.balance}</span> ₽</div>
                        <div>Ставка: <span style="color: #00ccff;" id="currentBet">${this.currentBet}</span> ₽</div>
                    </div>
                    
                    <div class="bet-controls">
                        <button class="btn bet-minus">-10</button>
                        <span class="bet-amount">Ставка: ${this.currentBet} ₽</span>
                        <button class="btn bet-plus">+10</button>
                    </div>
                    
                    <div class="coin-result" id="coinResult">
                        <i class="fas fa-coins"></i>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-register" id="headsBtn">Орел (x2)</button>
                        <button class="btn btn-login" id="tailsBtn">Решка (x2)</button>
                    </div>
                    
                    <div id="coinGameResult" style="text-align: center; margin-top: 20px;"></div>
                `;
                
                document.getElementById('headsBtn').addEventListener('click', () => {
                    this.flipCoin('heads');
                });
                
                document.getElementById('tailsBtn').addEventListener('click', () => {
                    this.flipCoin('tails');
                });
            }
            
            flipCoin(choice) {
                const coin = document.getElementById('coinResult');
                coin.classList.add('coin-flip');
                
                setTimeout(() => {
                    coin.classList.remove('coin-flip');
                    const result = Math.random() > 0.5 ? 'heads' : 'tails';
                    
                    coin.innerHTML = result === 'heads' 
                        ? '<i class="fas fa-crown"></i> Орел' 
                        : '<i class="fas fa-coins"></i> Решка';
                    
                    if (result === choice) {
                        const winAmount = this.currentBet * 2;
                        userSystem.updateBalance(winAmount);
                        document.getElementById('coinGameResult').innerHTML = 
                            `<div style="color: #33cc33; font-size: 1.2rem;">
                                <i class="fas fa-check"></i> Вы выиграли ${winAmount} ₽!
                            </div>`;
                    } else {
                        userSystem.updateBalance(-this.currentBet);
                        document.getElementById('coinGameResult').innerHTML = 
                            `<div style="color: #ff3333; font-size: 1.2rem;">
                                <i class="fas fa-times"></i> Вы проиграли ${this.currentBet} ₽
                            </div>`;
                    }
                }, 500);
            }
        }
        
        // Инициализация игровой системы
        const gameSystem = new GameSystem();
        
        // Обработчики модальных окон
        document.getElementById('loginBtn').addEventListener('click', () => {
            document.getElementById('loginModal').style.display = 'flex';
        });
        
        document.getElementById('registerBtn').addEventListener('click', () => {
            document.getElementById('registerModal').style.display = 'flex';
        });
        
        document.getElementById('logoutBtn').addEventListener('click', () => {
            userSystem.logout();
        });
        
        // Форма входа
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const result = userSystem.login(username, password);
            
            if (result.success) {
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('loginForm').reset();
                alert(`Добро пожаловать, ${result.user.username}!`);
            } else {
                alert(result.message);
            }
        });
        
        // Форма регистрации
        document.getElementById('registerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            
            if (password !== confirmPassword) {
                alert('Пароли не совпадают!');
                return;
            }
            
            if (password.length < 4) {
                alert('Пароль должен содержать минимум 4 символа');
                return;
            }
            
            const result = userSystem.register(username, email, password);
            
            if (result.success) {
                document.getElementById('registerModal').style.display = 'none';
                document.getElementById('registerForm').reset();
                alert(`Регистрация успешна! Добро пожаловать, ${username}! Вам начислено 1000 ₽.`);
            } else {
                alert(result.message);
            }
        });
        
        // Переключение между формами
        document.getElementById('showRegisterForm').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('registerModal').style.display = 'flex';
        });
        
        document.getElementById('showLoginForm').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('registerModal').style.display = 'none';
            document.getElementById('loginModal').style.display = 'flex';
        });
        
        // Закрытие модальных окон
        document.getElementById('closeLoginModal').addEventListener('click', () => {
            document.getElementById('loginModal').style.display = 'none';
        });
        
        document.getElementById('closeRegisterModal').addEventListener('click', () => {
            document.getElementById('registerModal').style.display = 'none';
        });
        
        document.getElementById('closeGameModal').addEventListener('click', () => {
            document.getElementById('gameModal').style.display = 'none';
        });
        
        // Закрытие по клику вне окна
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
        
        // Демо-аккаунт для быстрого входа
        document.addEventListener('DOMContentLoaded', () => {
            // Создаем демо-пользователя, если нет пользователей
            if (userSystem.users.length === 0) {
                userSystem.register('demo', 'demo@almaz.com', 'demo123');
            }
            
            // Подсказка для демо-входа
            setTimeout(() => {
                if (!userSystem.currentUser) {
                    console.log('Демо-доступ: логин: demo, пароль: demo123');
                }
            }, 1000);
        });
    </script>
</body>
</html>
